<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accurate Ad Blocker Detector</title>
    <style>
        #detection-test {
            position: absolute;
            left: -9999px;
            height: 1px;
            width: 1px;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <h1>Ad Blocker Test</h1>
    <div id="status">Testing...</div>

    <div id="detection-test" class="ad-unit"></div>

    <script>
        (async function() {
            // Configuration - Update this to your actual detection file URL
            const TEST_FILE_URL = '/detection-file.js';
            
            // Method 1: Element visibility check
            function checkElementVisibility() {
                const testElement = document.getElementById('detection-test');
                if (!testElement) return true;
                
                const style = window.getComputedStyle(testElement);
                return style.display === 'none' || 
                       style.visibility === 'hidden' ||
                       testElement.offsetHeight === 0;
            }

            // Method 2: File existence check
            async function checkFileAccess() {
                try {
                    // First check if the file actually exists
                    const headResponse = await fetch(TEST_FILE_URL, {method: 'HEAD'});
                    if (!headResponse.ok) {
                        console.error('Detection file not found on server!');
                        return false;
                    }

                    // Then try to load the file
                    const response = await fetch(TEST_FILE_URL);
                    return !response.ok;
                } catch (error) {
                    return true;
                }
            }

            // Method 3: Create fake ad element
            function checkDynamicElement() {
                const testAd = document.createElement('div');
                testAd.innerHTML = '&nbsp;';
                testAd.className = 'ad-box';
                testAd.style.height = '1px';
                document.body.appendChild(testAd);

                const isHidden = testAd.offsetHeight === 0;
                document.body.removeChild(testAd);
                return isHidden;
            }

            // Combined verification
            async function runDetection() {
                // Verify server file exists first
                const serverCheck = await fetch(TEST_FILE_URL, {method: 'HEAD'});
                if (!serverCheck.ok) {
                    throw new Error('Detection file missing on server');
                }

                const results = await Promise.all([
                    checkElementVisibility(),
                    checkFileAccess(),
                    checkDynamicElement()
                ]);

                return results.some(result => result === true);
            }

            // Display results
            async function showStatus() {
                const status = document.getElementById('status');
                
                try {
                    const isBlocked = await runDetection();
                    status.textContent = isBlocked 
                        ? 'Ad blocker detected' 
                        : 'No ad blocker found';
                    status.style.color = isBlocked ? '#d32f2f' : '#388e3c';
                } catch (error) {
                    status.textContent = 'Configuration error: ' + error.message;
                    status.style.color = '#f57c00';
                }

                status.style.fontWeight = 'bold';
                status.style.padding = '10px';
                status.style.marginTop = '20px';
            }

            // Start detection after short delay
            setTimeout(showStatus, 1000);
        })();
    </script>
</body>
</html>
