<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNS Ad Blocker Detector</title>
    <style>
        #ad-test {
            position: absolute;
            left: -9999px;
            height: 1px;
            width: 1px;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <h1>Ad Blocker Test</h1>
    <div id="status">Testing...</div>

    <div id="ad-test" class="ad-box"></div>

    <script>
        (async function() {
            // Configuration - Use a non-ad sounding filename
            const TEST_FILE_URL = './detection-asset.js';
            
            // Method 1: DNS-pattern-independent element check
            function checkElementHiding() {
                const testElement = document.getElementById('ad-test');
                if (!testElement) return true;
                
                return testElement.offsetHeight === 0 || 
                       window.getComputedStyle(testElement).display === 'none';
            }

            // Method 2: DNS-resistant network check
            async function checkNetworkBlock() {
                try {
                    // Test a non-ad sounding URL
                    const response = await fetch('/detection-asset.js?rand=' + Math.random());
                    return !response.ok;
                } catch (error) {
                    return true;
                }
            }

            // Method 3: Shadow DOM test (bypasses CSS blocking)
            function checkShadowDOM() {
                const testElement = document.createElement('div');
                testElement.className = 'ad-container';
                const shadow = testElement.attachShadow({ mode: 'open' });
                shadow.innerHTML = `<style>
                    :host { display: block !important; height: 1px !important; }
                </style>`;
                
                document.body.appendChild(testElement);
                const isHidden = testElement.offsetHeight === 0;
                document.body.removeChild(testElement);
                return isHidden;
            }

            async function runDetection() {
                const results = await Promise.all([
                    checkElementHiding(),
                    checkNetworkBlock(),
                    checkShadowDOM()
                ]);

                return results.some(result => result === true);
            }

            async function showStatus() {
                const status = document.getElementById('status');
                
                try {
                    const isBlocked = await runDetection();
                    status.textContent = isBlocked 
                        ? 'Ad blocking detected (DNS or client-side)' 
                        : 'No ad blocking detected';
                    status.style.color = isBlocked ? '#c62828' : '#2e7d32';
                } catch (error) {
                    status.textContent = 'Test failed - check connection';
                    status.style.color = '#ef6c00';
                }

                status.style.fontWeight = 'bold';
                status.style.padding = '15px';
                status.style.marginTop = '20px';
            }

            // Start detection
            setTimeout(showStatus, 1500);
        })();
    </script>
</body>
</html>
