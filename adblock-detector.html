<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ad Blocker Detector with File Check</title>
    <style>
        .ad-test {
            position: absolute;
            left: -9999px;
            height: 1px;
            width: 1px;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <h1>Ad Blocker Detection Test</h1>
    <div id="status">Checking for ad blocker...</div>

    <!-- Test elements -->
    <div class="ad-test" id="ad-banner"></div>
    <div class="ad-test" id="ad-container"></div>

    <script>
        (function() {
            const detectionMethods = {
                // Check if test elements are hidden
                elementCheck: () => {
                    const elements = document.querySelectorAll('.ad-test');
                    return Array.from(elements).some(el => {
                        const style = window.getComputedStyle(el);
                        return style.display === 'none' || 
                               el.offsetHeight === 0 ||
                               style.visibility === 'hidden';
                    });
                },

                // Check fake ad file request
                fileCheck: () => {
                    return new Promise((resolve) => {
                        const testScript = document.createElement('script');
                        testScript.src = '/stickyads.js'; // This file should exist on your server
                        testScript.onload = () => {
                            document.body.removeChild(testScript);
                            resolve(false);
                        };
                        testScript.onerror = () => {
                            document.body.removeChild(testScript);
                            resolve(true);
                        };
                        document.body.appendChild(testScript);
                    });
                },

                // Check known ad URLs
                networkCheck: async () => {
                    try {
                        const urls = [
                            'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js',
                            'https://adservice.google.com/adsid/integrator.js',
                            '/stickyads.js' // Local test file
                        ];

                        const results = await Promise.all(urls.map(url => 
                            fetch(url, { method: 'HEAD' })
                                .then(res => !res.ok)
                                .catch(() => true)
                        ));

                        return results.some(blocked => blocked);
                    } catch {
                        return false;
                    }
                }
            };

            async function detectAdBlock() {
                // Run checks in parallel
                const [elementResult, fileResult, networkResult] = await Promise.all([
                    detectionMethods.elementCheck(),
                    detectionMethods.fileCheck(),
                    detectionMethods.networkCheck()
                ]);

                return elementResult || fileResult || networkResult;
            }

            // Initialize detection
            window.addEventListener('DOMContentLoaded', async () => {
                setTimeout(async () => {
                    const status = document.getElementById('status');
                    try {
                        const isBlocked = await detectAdBlock();
                        
                        status.textContent = isBlocked 
                            ? 'Ad blocker detected! ðŸ›‘' 
                            : 'No ad blocker detected âœ…';
                            
                        status.style.color = isBlocked ? '#dc3545' : '#28a745';
                    } catch (e) {
                        status.textContent = 'Detection failed - Refresh to try again';
                        status.style.color = '#ffc107';
                    }
                    
                    // Styling
                    status.style.fontWeight = 'bold';
                    status.style.padding = '15px';
                    status.style.borderRadius = '5px';
                    status.style.marginTop = '20px';
                    status.style.backgroundColor = '#f8f9fa';
                }, 1000); // Give enough time for all checks
            });
        })();
    </script>
</body>
</html>
