<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Precision Ad Block Detector</title>
    <style>
        #test-element {
            position: absolute;
            left: -9999px;
            height: 1px;
            width: 1px;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <h1>Ad Block Detection Test</h1>
    <div id="status">Initializing checks...</div>

    <div id="test-element" class="detection-box"></div>

    <script>
        (async function() {
            // 1. Server files configuration (MUST CREATE THESE)
            const TEST_FILE = '/test-file-123.js'; // Update path
            const CONTROL_FILE = './control-file-456.js'; // Update path

            // 2. Verify server configuration
            async function verifyServer() {
                try {
                    const [testResponse, controlResponse] = await Promise.all([
                        fetch(TEST_FILE, {method: 'HEAD'}),
                        fetch(CONTROL_FILE, {method: 'HEAD'})
                    ]);
                    return testResponse.ok && controlResponse.ok;
                } catch {
                    return false;
                }
            }

            // 3. Main detection logic
            async function detectAdBlock() {
                if (!await verifyServer()) {
                    throw new Error('Server configuration error');
                }

                // 4. Network request checks
                const [testRequest, controlRequest] = await Promise.all([
                    fetch(TEST_FILE + '?rand=' + Math.random()),
                    fetch(CONTROL_FILE + '?rand=' + Math.random())
                ]);

                // 5. Shadow DOM element check
                const shadowHost = document.createElement('div');
                const shadow = shadowHost.attachShadow({mode: 'open'});
                shadow.innerHTML = `<div class="test-ad" style="height:1px"></div>`;
                document.body.appendChild(shadowHost);
                const elementVisible = shadow.firstChild.offsetHeight > 0;
                document.body.removeChild(shadowHost);

                return {
                    testBlocked: !testRequest.ok,
                    controlBlocked: !controlRequest.ok,
                    elementHidden: !elementVisible
                };
            }

            // 6. Display results
            async function showResults() {
                const status = document.getElementById('status');
                
                try {
                    const {testBlocked, controlBlocked, elementHidden} = await detectAdBlock();
                    
                    if (controlBlocked) {
                        status.textContent = "Network error detected";
                        status.style.color = "#f39c12";
                    } else if (testBlocked || elementHidden) {
                        status.textContent = "Ad blocking detected!";
                        status.style.color = "#e74c3c";
                    } else {
                        status.textContent = "No ad blocking detected";
                        status.style.color = "#2ecc71";
                    }
                } catch (error) {
                    status.textContent = error.message;
                    status.style.color = "#e67e22";
                }

                status.style.fontWeight = "bold";
                status.style.padding = "15px";
                status.style.marginTop = "20px";
            }

            setTimeout(showResults, 1500);
        })();
    </script>
</body>
</html>
