<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Pages Ad Block Detector</title>
    <style>
        #testElement {
            position: absolute;
            left: -9999px;
            height: 1px;
            width: 1px;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <h1>Ad Block Detection Test</h1>
    <div id="status">Initializing checks...</div>

    <div id="testElement" class="ad-test"></div>

    <script>
        (async function() {
            // GitHub Pages-specific configuration
            const REPO_NAME = window.location.pathname.split('/')[1] || '';
            const BASE_PATH = REPO_NAME ? `/${REPO_NAME}/` : '/';
            
            // Test files (MUST create these in your repository)
            const TEST_FILE = `${BASE_PATH}github-ads-test.js`;
            const CONTROL_FILE = `${BASE_PATH}github-control-file.js`;

            // Detection logic
            async function runDetection() {
                // 1. Verify files exist
                const [testExists, controlExists] = await Promise.all([
                    fetch(TEST_FILE, {method: 'HEAD'}),
                    fetch(CONTROL_FILE, {method: 'HEAD'})
                ]);

                if (!testExists.ok || !controlExists.ok) {
                    throw new Error('Missing test files - Add these to your repository:');
                }

                // 2. Test file loading
                const [testLoaded, controlLoaded] = await Promise.all([
                    fetch(TEST_FILE + '?rand=' + Math.random()),
                    fetch(CONTROL_FILE + '?rand=' + Math.random())
                ]);

                // 3. Element visibility check
                const testDiv = document.createElement('div');
                testDiv.className = 'ad-box';
                testDiv.style.height = '1px';
                document.body.appendChild(testDiv);
                const isHidden = testDiv.offsetHeight === 0;
                document.body.removeChild(testDiv);

                return {
                    testBlocked: !testLoaded.ok,
                    controlBlocked: !controlLoaded.ok,
                    elementHidden: isHidden
                };
            }

            // Display results
            async function showResults() {
                const status = document.getElementById('status');
                
                try {
                    const {testBlocked, controlBlocked, elementHidden} = await runDetection();
                    
                    if (controlBlocked) {
                        status.textContent = "Network issue detected";
                        status.style.color = "#f1c40f";
                    } else if (testBlocked || elementHidden) {
                        status.textContent = "Ad blocker detected!";
                        status.style.color = "#e74c3c";
                    } else {
                        status.textContent = "No ad blocker found";
                        status.style.color = "#2ecc71";
                    }
                } catch (error) {
                    status.innerHTML = `${error.message}<br>
                        <a href="${TEST_FILE}" target="_blank">Test File</a> | 
                        <a href="${CONTROL_FILE}" target="_blank">Control File</a>`;
                    status.style.color = "#e67e22";
                }

                status.style.fontWeight = "bold";
                status.style.padding = "15px";
                status.style.marginTop = "20px";
            }

            setTimeout(showResults, 2000);
        })();
    </script>
</body>
</html>
